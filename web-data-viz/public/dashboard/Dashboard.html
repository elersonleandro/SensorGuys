<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard || View Coffee</title>
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="shortcut icon" href="../assets/img/logo_image.png">
</head>

<body onload="verificarGerente(),  plotarGrafico()">
    <header>
        <div class="header">
            <div class="header_left">
                <a href="../index.html"><img src="../assets/img/logo_image.png" alt="logo do projeto"></a>
            </div>
            <nav class="navbar">
                <div class="header_center">
                    <ul>
                        <li id="gerenciar_fun" style="display: none;"><a href="./GerenciarFunc.html">Gerenciar
                                Funcionários</a></li>
                    </ul>
                </div>
                <div class="header_right">
                    <ul>
                        <img src="../assets/img/headerLinha.png" alt="">
                        <li><a href="../index.html">Página Inicial</a></li>
                    </ul>
            </nav>
        </div>
    </header>
    <section>
        <div class="dashboard">
            <div class="status">
                <table>
                    <thead>
                        <tr>
                            <th>armazens</th>
                            <th>temperatura</th>
                            <th>umidade</th>
                            <th>status</th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr>
                            <td>Armazem 1</td>
                            <td>30°</td>
                            <td>62%</td>
                            <td>
                                <div class="status-indicador red"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 2</td>
                            <td>10°</td>
                            <td>52%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 3</td>
                            <td>15°</td>
                            <td>57%</td>
                            <td>
                                <div class="status-indicador yellow"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 4</td>
                            <td>11°</td>
                            <td>53%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 5</td>
                            <td>10°</td>
                            <td>52%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 6</td>
                            <td>9°</td>
                            <td>50%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 7</td>
                            <td>10°</td>
                            <td>52%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>Armazem 8</td>
                            <td>10°</td>
                            <td>52%</td>
                            <td>
                                <div class="status-indicador green"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="grafico-container">
                <div class="grafico-dentro">
                    <h2>Gráfico de Temperatura</h2>
                    <canvas id="grafico_temperatura1"></canvas>
                </div>
                <div class="grafico-dentro">
                    <h2>Gráfico de Umidade</h2>
                    <canvas id="grafico_umidade1"></canvas>
                </div>
            </div>
            <div class="status2">
                <p>alertas</p>
                <img src="../assets/img/linha.png" alt="">
                <div class="cardalerta">
                    <p>Armazem 3</p>
                    <p>temperatura 5º acima da média</p>
                    <p>umidade 10% abaixo da média</p>
                    <p>04-06-2024 12:51:0</p>
                </div>
                <img src="../assets/img/linha.png" alt="">
                <div class="cardalerta">
                    <p>Armazem 1</p>
                    <p>temperatura 20º acima da média</p>
                    <p>umidade 20% abaixo da média</p>
                    <p>04-06-2024 12:51:0</p>
                </div>
                <img src="../assets/img/linha.png" alt="">
                <div class="cardalerta">
                    <p>Armazem 7</p>
                    <p>temperatura 20º abaixo da média</p>
                    <p>umidade 20% acima da média</p>
                    <p>04-06-2024 12:51:0</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div id='footer' class='footer'>
            <div class='rectangle39'>
                <img id='viewcoffee' class='viewcoffee' src='../assets/img/logo_image.png'>
            </div>
            <div class='rectangle38'>

                <div id='contate-nos' class='contate-nos'>
                    <a href="../contate-nos.html">
                        Contate-nos
                    </a>
                    <img id='outlook' class='outlook' src="../assets/img/img_outlook.png">
                </div>
            </div>

            <div class='todosdireitosreservados'>
                @ 2024 todos direitos reservados

            </div>

        </div>
    </footer>
</body>

</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>

<script>

    const contextoLm35Temperatura = document.getElementById('grafico_temperatura1').getContext('2d');
    const contextoDht11Umidade = document.getElementById('grafico_umidade1');
</script>

<script>
    var graficoTemp = new Chart(
        contextoLm35Temperatura,
        {
            type: 'line',

            data: {
                labels: [],
                datasets: [{
                    type: 'line',
                    label: 'Temperatura',
                    data: [],
                    borderColor: ['#08241c'],
                    backgroundColor: ['#08241c']
                }]

            }

        }
    );

    var graficoUmid = new Chart(
        contextoDht11Umidade,
        {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    type: 'line',
                    label: 'Umidade',
                    data: [],
                    borderColor: ['#08241c'],
                    backgroundColor: ['#08241c']
                }]
            }
        }
    );
    function mudarArmazem() {
        var armazem = select_armazem.value;

        if (armazem == 1) {
            graphic1.style = 'display: flex;';
            graphic2.style = 'display: none';
            graphic3.style = 'display: none';
            umidade.innerHTML = ''
            temperatura.innerHTML = ''
        }

        if (armazem == 2) {
            graphic1.style = 'display: none;';
            graphic2.style = 'display: flex';
            graphic3.style = 'display: none';
            umidade.innerHTML = `57%`;
            temperatura.innerHTML = `27.86°C`
        }
        if (armazem == 3) {
            graphic1.style = 'display: none;';
            graphic2.style = 'display: none';
            graphic3.style = 'display: flex';

            umidade.innerHTML = `60%`
            temperatura.innerHTML = `25.2°C`
        }

        // umidade.innerHTML = `${umidadeValue}%`
        // temperatura.innerHTML = `${temperaturaValue}°C`


    }

    function verificarGerente() {
        if (sessionStorage.CARGO_USUARIO == 'gerente' || sessionStorage.CARGO_USUARIO == 'Gerente') {
            gerenciar_fun.style.display = "block"
        }
    }

    async function plotarGrafico() {
        let lista_dadosTemp = [];
        let lista_dadosUmid = [];
        let lista_data = [];
        let idArmazem = 1;
        let idEmpresa = sessionStorage.ID_EMPRESA;

        fetch("/dados/plotarGrafico", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                armazemServer: idArmazem,
                empresaServer: idEmpresa
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 200) {
                    resposta.json().then(function (resposta) {
                        for (var index = 0; index < resposta.length; index++) {
                            var dadoTemp = resposta[index].temperatura;
                            var dadoUmid = resposta[index].umidade;
                            var dataDado = resposta[index].dataDado;

                            
                        }


                        setInterval(plotarGrafico, 10000)

                    })
                }
                else {
                    console.log("Não foi encontrado nenhum dado")
                    alert("Não foi encontrado nenhum dado")
                    return false;
                }
            }
        })
    }




</script>