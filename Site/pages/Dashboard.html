<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard || View Coffee</title>
    <link rel="stylesheet" href="../style/header.css">
    <link rel="stylesheet" href="../style/dashboard.css">
    <link rel="stylesheet" href="../style/footer.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <header>
        <div class="header">
            <div class="header_left">
                <a href="../index.html"><img src="../img/logo_image.png" alt="logo do projeto"></a>
            </div>
            <nav class="navbar">
                <div class="header_center">
                    <ul>
                        <li><a href="GerenciarFunc.html">Gerenciar Funcionários</a></li>
                    </ul>
                </div>
                <div class="header_right">
                    <ul>
                        <img src="../img/headerLinha.png" alt="">
                        <li><a href="../index.html">Página Inicial</a></li>
                    </ul>
            </nav>
        </div>
    </header>
    <section>
        <div class="dashboard">
            <div class="armazem">
                <select id="select_armazem" onchange="mudarArmazem()">
                    <option value=1>Armazém 1</option>
                    <option value=2>Armazém 2</option>
                    <option value=3>Armazém 3</option>
                </select>

            </div>
            <div class="dado">
                <div class="card">
                    <div id="temperatura_card">
                        <h1>Temperatura</h1>
                    </div>
                    <div class="card_content">
                        <div class="dado_card">
                            <span>Atual</span>
                            <div id="temperatura"></div>
                        </div>
                        <div class="dado_card">
                            <span>Recomendado</span>
                            <span>20°C</span>
                        </div>
                    </div>

                </div>

                <div class="card">
                    <div id="umidade_card">
                        <h1>Umidade</h1>
                    </div>
                    
                    <div class="card_content">
                        <div class="dado_card">
                            <span>Atual</span>
                            <div id="umidade"></div>
                        </div>
                        <div class="dado_card">
                            <span>Recomendado</span>
                            <span>60%</span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="grafico" id="graphic1">

                <div class="content_grafico">
                    <canvas id="grafico_temperatura1"></canvas>
                </div>
                <div class="content_grafico">
                    <canvas id="grafico_umidade1"></canvas>
                </div>
            </div>
            <div class="grafico" id="graphic2" style="display: none;">
                <div class="content_grafico">
                    <canvas id="grafico_temperatura2"></canvas>
                </div>
                <div class="content_grafico">
                    <canvas id="grafico_umidade2"></canvas>
                </div>
            </div>
            <div class="grafico" id="graphic3" style="display: none;">
                <div class="content_grafico">
                    <canvas id="grafico_temperatura3"></canvas>
                </div>
                <div class="content_grafico">
                    <canvas id="grafico_umidade3"></canvas>
                </div>
            </div>
    </section>

    <footer>
        <div id='footer' class='footer'>
            <div class='rectangle39'>
                <img id='viewcoffee' class='viewcoffee' src='../img/logo_image.png'>
            </div>
            <div class='rectangle38'>

                <div id='contate-nos' class='contate-nos'>
                    Contate-nos
                    <img id='outlook' class='outlook' src="../img/img_outlook.png">
                </div>
            </div>

            <div class='todosdireitosreservados'>
                @ 2024 todos direitos reservados

            </div>

        </div>
    </footer>
</body>

</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>


<script>

    const contextoLm35Temperatura1 = document.getElementById('grafico_temperatura1').getContext('2d');
    const contextoDht11Umidade1 = document.getElementById('grafico_umidade1');
    const contextografico_temperatura2 = document.getElementById('grafico_temperatura2');
    const contextografico_umidade2 = document.getElementById('grafico_umidade2');
    const contextografico_temperatura3 = document.getElementById('grafico_temperatura3');
    const contextografico_umidade3 = document.getElementById('grafico_umidade3');
    
    var lm35Temperatura = new Chart(
            contextoLm35Temperatura1,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Temperatura',
                        type: 'line',
                        borderColor: ['#D9C9BA'],
                        backgroundColor: ['#D9C9BA']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Temperatura'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        var dht11Umidade = new Chart(
            contextoDht11Umidade1,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Umidade',
                        type: 'line',
                        borderColor: ['#D9C9BA'],
                        backgroundColor: ['#D9C9BA']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Umidade'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


    new Chart(contextografico_temperatura2,
        {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Temperatura',
                        backgroundColor: '#D9C9BA',
                        borderColor: '#D9C9BA',
                        data: [25.42, 25.42, 26.39, 27.37, 28.84, 27.86]
                    }

                ]

            }
        }
    )
    new Chart(contextografico_umidade2,
        {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Umidade',
                        backgroundColor: '#D9C9BA',
                        borderColor: '#D9C9BA',
                        data: [54, 56, 52, 53, 55, 57]
                    }

                ]

            }
        }
    )
    new Chart(contextografico_temperatura3,
        {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Temperatura',
                        backgroundColor: '#D9C9BA',
                        borderColor: '#D9C9BA',
                        data: [25.9, 25.42, 26.39, 25.45, 26.32, 25.42]
                    }

                ]

            }
        }
    )
    new Chart(contextografico_umidade3,
        {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Umidade',
                        backgroundColor: '#D9C9BA',
                        borderColor: '#D9C9BA',
                        data: [71, 71.1, 60.2, 61.5, 61.8, 60]
                    }

                ]

            }
        }
    )



</script>

<script>
    const Toast = Swal.mixin({
        toast: true,
        background: 'black',
        color: 'white',
        title: "Alerta!",
        icon: 'warning',
        toast: true,
                
    });

    function mudarArmazem() {
        var armazem = select_armazem.value;
       
        if(armazem == 1)
        {
            graphic1.style = 'display: flex;';
            graphic2.style = 'display: none';
            graphic3.style = 'display: none';
            umidade.innerHTML = ''
            temperatura.innerHTML = ''
        }

        if (armazem == 2) {
            graphic1.style = 'display: none;';
            graphic2.style = 'display: flex';
            graphic3.style = 'display: none';
            umidade.innerHTML = `57%`;
            temperatura.innerHTML = `27.86°C`
        }
        if (armazem == 3) {
            graphic1.style = 'display: none;';
            graphic2.style = 'display: none';
            graphic3.style = 'display: flex';

            umidade.innerHTML = `60%`
            temperatura.innerHTML = `25.2°C`
        }

            // umidade.innerHTML = `${umidadeValue}%`
            // temperatura.innerHTML = `${temperaturaValue}°C`

        if(temperaturaJson > 30 && umidadeJson > 65)
        {
            Toast.fire({
                text: 'Temperatura e umidade elevadas!'
            })
        }
        else if (temperaturaJson > 30) {
            Toast.fire({
                text: 'Temperatura elevada!'
            })
        }

        else if (umidadeJson > 60)
        {
            Toast.fire({
                text: "Umidade elevada!"
            })  
        }
        else if (temperaturaJson < 15 && umidadeJson < 45)
        {
            Toast.fire({
                text: "Temperatura e umidade decaidas!"
            })  
        }
        else if(temperaturaJson < 15){
            Toast.fire({
                text: "Temperatura Decaída!",
            })  
        }
        else if(umidadeJson < 45)
        {
            Toast.fire({
                text: "Umidade Decaída!",
            }) 
        }
    }





        // var paginacao = {};
        // var tempo = {};
        // var valorJson = [];
        // var umidadeJson = 0;
        // var temperaturaJson = 0;
        // function obterDados(grafico, endpoint) {
        //     var http = new XMLHttpRequest();
        //     http.open('GET', 'http://localhost:3300/sensores/' + endpoint, false);
        //     http.send(null);
        //     var valores = JSON.parse(http.responseText);
        //     if (paginacao[endpoint] == null) {
        //         paginacao[endpoint] = 0;
        //     }
        //     if (tempo[endpoint] == null) {
        //         tempo[endpoint] = 0;
        //     }
        //     // Exibir à partir do último elemento exibido anteriormente
        //     var ultimaPaginacao = paginacao[endpoint];
        //     paginacao[endpoint] = valores.length;
        //     var valores = valores.slice(ultimaPaginacao);
        //     valores.forEach((valor) => {
        //         //Máximo de 60 itens exibidos no gráfico
        //         if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
        //             grafico.data.labels.shift();
        //             grafico.data.datasets[0].data.shift();
        //         }

        

</script>